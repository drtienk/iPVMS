<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login</title>

  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", "Noto Sans TC", Arial, sans-serif;
      background: #f6f7f9;
      padding: 40px;
      margin: 0;
    }

    .login-box {
      max-width: 360px;
      margin: 0 auto;
      background: #fff;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.08);
    }

    /* ✅ 語言列（右上） */
    .topbar{
      display:flex;
      justify-content:flex-end;
      align-items:center;
      gap:8px;
      margin-bottom: 6px;
    }
    .topbar label{
      font-size: 13px;
      color:#374151;
    }
    .topbar select{
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      background: #fff;
      font-size: 13px;
    }

    h2 {
      margin-top: 6px;
      text-align: center;
    }

    label {
      display: block;
      margin-top: 12px;
      margin-bottom: 4px;
    }

    input, select {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
    }

    button {
      margin-top: 16px;
      width: 100%;
      padding: 10px;
      cursor: pointer;
    }

    #msg {
      margin-top: 12px;
      color: red;
      min-height: 18px;
    }
  </style>
</head>
<body>

  <div class="login-box">

    <!-- ✅ 語言下拉 -->
    <div class="topbar">
      <label id="langLabel" for="langSelect">Language</label>
      <select id="langSelect">
        <option value="en">English</option>
        <option value="zh">中文</option>
      </select>
    </div>

    <!-- ✅ 標題：不再寫 Admin 登入 -->
    <h2 id="title">Login</h2>

    <label id="userLabel">Username</label>
    <!-- ✅ 不要 placeholder 有 admin -->
    <input id="username" type="text" autocomplete="username">

    <label id="passLabel">Password</label>
    <input id="password" type="password" autocomplete="current-password">

    <!-- 公司列：預設隱藏 -->
    <div id="companyRow" style="display:none;">
      <label id="companyLabel">Company (Admin only)</label>
      <select id="company" disabled>
        <option value="">-- Select a company --</option>
      </select>
    </div>

    <button id="loginBtn" onclick="login()">Next</button>
    <button id="backBtn" onclick="goBack()" style="display:none;">Back</button>

    <p id="msg"></p>
  </div>

  <script>
    /* =============================
       帳號資料（前端假資料）
       ============================= */
      const USER_ACCOUNTS = {
        admin: { password: "admin", role: "admin" },

        user1: {
          password: "user1",
          role: "user",
          companyId: "TEST_CO",
          companyName: "TEST CO."
        },

        user2: {
          password: "user2",
          role: "user",
          companyId: "ABC_CO",
          companyName: "ABC CO."
        }
      };


    const COMPANY_LIST = ["TEST CO.", "ABC CO."];
    const COMPANY_ID_MAP = {
  "TEST CO.": "TEST_CO",
  "ABC CO.": "ABC_CO"
};

    let isAdminVerified = false;

    /* =============================
       ✅ 語言系統：預設英文、可切中文
       ============================= */
    const I18N = {
      en: {
        docLang: "en",
        title: "Login",
        langLabel: "Language",
        userLabel: "Username",
        passLabel: "Password",
        companyLabel: "Company (Admin only)",
        companyPlaceholder: "-- Select a company --",
        btnNext: "Next",
        btnLogin: "Login",
        btnBack: "Back",
        msgPickCompany: "Please select a company",
        msgBadCred: "Invalid username or password",
        msgRoleErr: "Role configuration error"
      },
      zh: {
        docLang: "zh-Hant",
        title: "登入",
        langLabel: "語言",
        userLabel: "帳號",
        passLabel: "密碼",
        companyLabel: "公司（僅限管理員）",
        companyPlaceholder: "-- 請選擇公司 --",
        btnNext: "下一步",
        btnLogin: "登入",
        btnBack: "回到上一頁",
        msgPickCompany: "請選擇公司",
        msgBadCred: "帳號或密碼錯誤",
        msgRoleErr: "角色設定錯誤"
      }
    };

    const langSelect = document.getElementById("langSelect");
    function getLang() {
      return localStorage.getItem("app_lang") || "en";
    }

    function applyLanguage(lang) {
      const t = I18N[lang] || I18N.en;

      document.documentElement.lang = t.docLang;
      document.title = t.title;

      document.getElementById("title").textContent = t.title;
      document.getElementById("langLabel").textContent = t.langLabel;
      document.getElementById("userLabel").textContent = t.userLabel;
      document.getElementById("passLabel").textContent = t.passLabel;
      document.getElementById("companyLabel").textContent = t.companyLabel;

      // 公司下拉第一個選項文字
      const companySelect = document.getElementById("company");
      if (companySelect && companySelect.options.length > 0) {
        companySelect.options[0].textContent = t.companyPlaceholder;
      }

      // 按鈕文字要依「目前是第幾步」決定
      document.getElementById("loginBtn").textContent = (isAdminVerified ? t.btnLogin : t.btnNext);
      document.getElementById("backBtn").textContent = t.btnBack;

      // msg 不強制翻譯舊內容（避免切語言把訊息弄亂），切語言先清空
      document.getElementById("msg").textContent = "";
    }

    // 初始化語言
    window.addEventListener("DOMContentLoaded", () => {
      const savedLang = getLang();
      langSelect.value = savedLang;
      applyLanguage(savedLang);

      // 預設隱藏公司列
      document.getElementById("companyRow").style.display = "none";
      document.getElementById("company").disabled = true;

      // 焦點
      document.getElementById("username").focus();

      // Enter 觸發登入（選單上不觸發）
      document.addEventListener("keydown", (e) => {
        if (e.key !== "Enter") return;
        const active = document.activeElement;
        if (active && active.tagName === "SELECT") return;
        e.preventDefault();
        login();
      });
    });

    // 語言切換：立刻生效 + 存起來（下一頁也同語言）
    langSelect.addEventListener("change", function () {
      localStorage.setItem("app_lang", this.value);
      applyLanguage(this.value);
    });

    /* =============================
       顯示公司下拉 + 載入公司
       ============================= */
    function showCompanyDropdown() {
      const companyRow = document.getElementById("companyRow");
      const companySelect = document.getElementById("company");
      const loginBtn = document.getElementById("loginBtn");
      const backBtn = document.getElementById("backBtn");

      companyRow.style.display = "block";
      companySelect.disabled = false;

      // 清掉舊選項（保留第 0 個 placeholder）
      while (companySelect.options.length > 1) companySelect.remove(1);

      COMPANY_LIST.forEach((name) => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        companySelect.appendChild(opt);
      });

      // 依語言更新文字
      const t = I18N[getLang()] || I18N.en;
      loginBtn.textContent = t.btnLogin;
      backBtn.style.display = "block";
      companySelect.focus();
    }

    /* =============================
       登入主流程（保留你原本兩段式）
       ============================= */
    function login() {
      const u = document.getElementById("username").value.trim();
      const p = document.getElementById("password").value.trim();
      const c = document.getElementById("company").value;
      const msgEl = document.getElementById("msg");
      const t = I18N[getLang()] || I18N.en;

      msgEl.textContent = "";

      const account = USER_ACCOUNTS[u];
      if (!account || account.password !== p) {
        msgEl.textContent = t.msgBadCred;
        return;
      }

      // admin 兩段式
      if (account.role === "admin") {
        if (!isAdminVerified) {
          isAdminVerified = true;
          showCompanyDropdown();
          msgEl.textContent = t.msgPickCompany;
          return;
        }

        if (c === "") {
          msgEl.textContent = t.msgPickCompany;
          return;
        }

                sessionStorage.setItem("loggedIn", "yes");
          sessionStorage.setItem("role", "admin");

          // ✅ admin 也用「統一格式」存公司
          sessionStorage.setItem("companyId", COMPANY_ID_MAP[c] || c);
          sessionStorage.setItem("companyName", c);

          window.location.href = "app.html";
return;

      }

      // user 直接登入
      // user 直接登入（公司已綁定）
      if (account.role === "user") {
        sessionStorage.setItem("loggedIn", "yes");
        sessionStorage.setItem("role", "user");

        // ✅ 自動帶公司
        sessionStorage.setItem("companyId", account.companyId);
        sessionStorage.setItem("companyName", account.companyName);

        window.location.href = "app.html";
        return;
      }


      msgEl.textContent = t.msgRoleErr;
    }

    /* =============================
       回到上一頁（回到輸入帳密狀態）
       ============================= */
    function goBack() {
      const companyRow = document.getElementById("companyRow");
      const companySelect = document.getElementById("company");
      const loginBtn = document.getElementById("loginBtn");
      const backBtn = document.getElementById("backBtn");
      const msgEl = document.getElementById("msg");
      const t = I18N[getLang()] || I18N.en;

      isAdminVerified = false;

      companyRow.style.display = "none";
      companySelect.disabled = true;
      companySelect.value = "";

      loginBtn.textContent = t.btnNext;
      backBtn.style.display = "none";
      msgEl.textContent = "";

      document.getElementById("username").focus();
    }
  </script>

</body>
</html>

